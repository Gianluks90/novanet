<div class="deck-builder-page-main-container">
    <section class="deck-view-container">
        <div class="section-header">
            <div class="side-line"></div>
            <div class="header-content">
                <h1 i18n>Deck View "{{form.get('name')?.value}}"</h1>
                <div class="actions-container">
                    <p i18n>{{mode === 'edit' ? '[ Edit mode ]' : '[ View only ]'}}</p>
                </div>
            </div>
        </div>
        @if (deck) {
        <div class="section-content view-content">
            @if (deck.identity) {
            <div class="identity-container" (click)="onCardClick(deck.identity)">
                <img loading="lazy" [src]="'https://card-images.netrunnerdb.com/v2/large/' + deck.identity.code + '.jpg'" alt="">
                <div class="identity-info">
                    <div class="identity-title">
                        @let identity = deck.identity;
                        @if (identity?.type_code === 'identity' && identity?.faction_code !== 'neutral-runner' && identity?.faction_code !== 'neutral-corp') {
                            <img class="faction-icon" [src]="'./images/faction-icons/' + identity?.faction_code+ '.svg'" alt="">
                        }
                        {{deck.identity.translations?.[locale]?.title!.split(':')[0] || deck.identity.title.split(':')[0]}}
                    </div>
                    <hr>
                    <div class="identity-subtitle">
                        {{deck.identity.translations?.[locale]?.title!.split(':')[1] || deck.identity.title.split(':')[1]}}
                    </div>  
                </div>
            </div>
            <app-card-detail [selectedCard]="selectedCard" [disableMenu]="true" [disableCenter]="true" [packs]="packs" (zoomCardEmit)="onCardZoomEmitted($event)"></app-card-detail>
            }
        </div>
        }
    </section>
    <section class="deck-form-container">
        <div class="section-header">
            <div class="side-line"></div>
            <div class="header-content">
                <h1 i18n>Deck Builder</h1>
                <div class="actions-container">
                    <span class="material-symbols-rounded">bottom_panel_close</span>
                    <span class="material-symbols-rounded">save</span>
                </div>
            </div>
        </div>
        <div class="section-content">
            <form class="form-container" [formGroup]="form">
                <div class="form-group">
                    <label for="name">Deck name</label>
                    <input i18n-placeholder="@@enterTextPlaceholder" type="text" name="name" id="name" formControlName="name" placeholder="Enter text" autocorrect="off" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="format-select">Format</label>
                    <select name="format" id="format-select" formControlName="format">
                        <option value="">Select format</option>
                        @for (f of formats; track $index) {
                            <option  [value]="f">{{f}}</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label for="identity-select">Identity</label>
                    <select name="identity" id="identity-select" formControlName="identity">
                        <option value="">Select identity</option>
                        @for (identity of identities; track $index) {
                            <option  [value]="identity.code">{{identity.translations?.[locale]?.title || identity.title}}</option>
                        }
                    </select>
                </div>
            </form>
            <form class="form-container card-form" [formGroup]="cardForm">
                <div class="form-group">
                    <label for="card-input">Add Card</label>
                    <input #cardInputEl type="text" 
                        formControlName="cardInput" 
                        placeholder="Enter card name or code" 
                        autocorrect="off" 
                        autocomplete="off"
                        >
                </div>
                <span class="material-symbols-rounded" (click)="resetFilters()">refresh</span>
            </form>
            <div class="filters-container" [formGroup]="filtersForm">
                <select id="faction-select" formControlName="faction">
                    <option i18n value="all">All Factions</option>
                    @for (f of factions; track $index) {
                        <option  [value]="f.code">{{f.code | factionLabel}}</option>
                    }
                </select>
                <select id="pack-select" formControlName="pack">
                    <option i18n value="all">All packs</option>
                    @for(cycle of cycles; track cycle.code) {
                    <optgroup [label]="cycle.name">
                        @for (pack of packs; track pack.code) {
                        @if (pack.cycle_code === cycle.code) {
                        <option [value]="pack.code">
                            {{ pack.name }}
                        </option>
                        }
                        }
                    </optgroup>
                    }
                </select>
                <select id="type-select" formControlName="type">
                    <option i18n value="all">All Types</option>
                    @for (t of types; track $index) {
                        <option  [value]="t.code">{{t.name! | typeLabel }}</option>
                    }
                </select>
            </div>
            <div class="cards-container">
                @for (c of filteredCards; track c.code) {
                    <div class="card-item" [class.even-item]="$even" (click)="selectCard(c)">
                        <span>{{c.translations?.[locale]?.title || c.title}}</span>
                        <section>
                            <span [innerHTML]="c | dots: factions"></span>
                            @if (c?.faction_code !== 'neutral-runner' && c?.faction_code !== 'neutral-corp') {
                                <img class="faction-icon" [src]="'./images/faction-icons/' + c?.faction_code+ '.svg'" alt="">
                            }
                        </section>
                    </div>
                }
            </div>
        </div>
    </section>
</div>

@if(selectedCard && cardZoomed) {
<div class="zoom-card-container">
    <div class="zoom-card-header">
        <p>Zoom</p>
        <span class="material-symbols-rounded" (click)="cardZoomed = false">close</span>
    </div>
    <div class="zoom-card-image">
        <img loading="lazy" [src]="'https://card-images.netrunnerdb.com/v2/large/' + selectedCard.code + '.jpg'" alt="">
    </div>
</div>
}