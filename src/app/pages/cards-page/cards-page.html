<div class="cards-page-main-container">
    <div class="filter-container">
        <div class="side-line"></div>
        <p class="section-title">Filters</p>
        <input type="text" placeholder="Search text..." (keyup)="onChangeTextSearch($event)">
        <div class="line-divider"></div>
        <p>Game</p>
        @if (factions.length > 0) {
            <select name="faction" id="faction-select" [(ngModel)]="filters.faction" (change)="onChangeFactionFilter($event)">
                <option value="all">All Factions</option>
                @for(faction of factions; track faction.code) {
                    <option [value]="faction.code">{{ faction.name }}</option>
                }
            </select>
        }
        @if (sides.length > 0) {
            <select name="side" id="side-select" [(ngModel)]="filters.side" (change)="onChangeSideFilter($event)">
                <option value="all">All Sides</option>
                @for(side of sides; track side.code) {
                    <option [value]="side.code">{{ side.name }}</option>
                }
            </select>
        }
        <div class="line-divider"></div>
        <p>Meta</p>
        @if(this.cycles.length > 0 && this.packs.length > 0) {
            <select name="pack" id="pack-select" [(ngModel)]="filters.pack" (change)="onChangePackFilter($event)">
                <option value="all">All packs</option>
            
                @for(cycle of cycles; track cycle.code) {
                <optgroup [label]="cycle.name">
                    @for (pack of packs; track pack.code) {
                    @if (pack.cycle_code === cycle.code) {
                    <option [value]="pack.code">
                        {{ pack.name }}
                    </option>
                    }
                    }
                </optgroup>
                }
            
            </select>
        }
        @if (types.length > 0) {
            <select name="type" id="type-select" [(ngModel)]="filters.type" (change)="onChangeTypeFilter($event)">
                <option value="all">All Types</option>
                @for(type of types; track type.code) {
                    <option [value]="type.code">{{ type.name }}</option>
                }
            </select>
        }
        <div class="reset-icon" (click)="resetFilters()">
            <span class="material-symbols-rounded">refresh</span>
        </div>
        <app-ui-diagonal-line position="bottom-right"></app-ui-diagonal-line>
    </div>
    <div class="content-container">
        <div class="attribution-container" (click)="toggleAttribution()">
                @if(showAttribution) {
                    <div class="attribution-text">
                        Card images and data provided by <a href="https://netrunnerdb.com/" target="_blank" rel="noopener noreferrer">NetrunnerDB</a>
                    </div>
                }
                <span class="material-symbols-rounded">info</span>
        </div>
        <div class="action-controls">
            <div class="control-container" (click)="zoomRotation()">
                <span class="material-symbols-rounded">zoom_in</span>
                Zoom: {{ zoomLevel.replace('-', ' ') }}
            </div>
            <div class="control-container" (click)="sortRotation()">
                <span class="material-symbols-rounded">sort</span>
                Sort by: {{ sortBy }} (found: {{cards.length}})
            </div>
        </div>
        <div class="cards-container" [class.small-size]="zoomLevel === 'small-size'" [class.medium-size]="zoomLevel === 'medium-size'" [class.large-size]="zoomLevel === 'large-size'" [class.standard-size]="zoomLevel === 'standard-size'">
            @for(card of cards; track card.code) {
                <div class="card-item" (click)="onCardClick(card)" [class.selected-card]="selectedCard && selectedCard.code === card.code" [class.not-selected-card]="selectedCard && selectedCard.code !== card.code">
                    <img loading="lazy" [src]="'https://card-images.netrunnerdb.com/v2/large/' + card.code + '.jpg'" alt="">
                </div>
            }
        </div>
        <div class="inspector-container" [class.empty-ispector]="!selectedCard">
            <!-- <p class="section-title">Inspector</p> -->
            @if (!selectedCard) {
                <span class="material-symbols-rounded">trackpad_input</span>
                <p>Select a card from the grid to inspect detail and actions.</p>
            } @else {
                @let c = selectedCard;
                @if(c.type_code === 'identity') {
                    <p class="section-title">{{c.title.split(':')[0]}}</p>
                    <p>{{c.title.split(':')[1]}}</p>
                } @else {
                    <p class="section-title">{{c.title}}</p>
                }
                <div class="card-text" [innerHTML]="c.text | nrIcons">
                </div>
            }
            <app-ui-diagonal-line position="bottom-right"></app-ui-diagonal-line>
        </div>
    </div>
</div>