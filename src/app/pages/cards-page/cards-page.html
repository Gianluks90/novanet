<div class="cards-page-main-container">
    <div class="filter-container">
        <div class="side-line"></div>
        <p i18n="@@filtersSectionTitle" class="section-title">Filters</p>
        <input i18n-placeholder="@@searchTextInputPlaceholder" type="text" placeholder="Search text..." (keyup)="onChangeTextSearch($event)">
        <input i18n-placeholder="@@costInputPlaceholder" type="number" inputmode="numeric" placeholder="cost" min="0" (input)="onChangeCostFilter($event)">
        <div class="line-divider"></div>
        <!-- <p>Info</p> -->
        @if (factions.length > 0) {
        <select name="faction" id="faction-select" [(ngModel)]="filters.faction"
            (change)="onChangeFactionFilter($event)">
            <option i18n value="all">All Factions</option>
            @for(faction of factions; track faction.code) {
            <option [value]="faction.code">{{ faction.code | factionLabel}}</option>
            }
        </select>
        }
        @if (sides.length > 0) {
        <select name="side" id="side-select" [(ngModel)]="filters.side" (change)="onChangeSideFilter($event)">
            <option i18n value="all">All Sides</option>
            @for(side of sides; track side.code) {
            <option [value]="side.code">{{ side.name }}</option>
            }
        </select>
        }
        <!-- <div class="line-divider"></div> -->
        <!-- <p>Meta</p> -->
        @if(this.cycles.length > 0 && this.packs.length > 0) {
        <select name="pack" id="pack-select" [(ngModel)]="filters.pack" (change)="onChangePackFilter($event)">
            <option i18n value="all">All packs</option>

            @for(cycle of cycles; track cycle.code) {
            <optgroup [label]="cycle.name">
                @for (pack of packs; track pack.code) {
                @if (pack.cycle_code === cycle.code) {
                <option [value]="pack.code">
                    {{ pack.name }}
                </option>
                }
                }
            </optgroup>
            }

        </select>
        }
        @if (types.length > 0) {
        <select name="type" id="type-select" [(ngModel)]="filters.type" (change)="onChangeTypeFilter($event)">
            <option i18n value="all">All Types</option>
            @for(type of types; track type.code) {
            <option [value]="type.code">{{ type.code | typeLabel }}</option>
            }
        </select>
        }
        <div class="reset-icon" (click)="resetFilters()">
            <span class="material-symbols-rounded">refresh</span>
        </div>
        @if (!firebase.$user()?.customBackgroundURL) {
            <app-ui-diagonal-line position="bottom-right"></app-ui-diagonal-line>
        }
    </div>
    <div class="content-container">
        <div class="footer-container">
            <div class="attribution-container" (click)="toggleAttribution()">
                @if(showAttribution) {
                <div i18n class="attribution-text">
                    Card images and data provided by <a href="https://netrunnerdb.com/" target="_blank"
                        rel="noopener noreferrer">NetrunnerDB</a>
                </div>
                }
                <span class="material-symbols-rounded">info</span>
            </div>
            @if(selectedCard) {
                <div class="deselect-card" (click)="selectedCard = null">
                    <span i18n> Deselect card </span>
                    <span class="material-symbols-rounded">close</span>
                </div>
            }
        </div>
        <div class="action-controls">
            <div i18n class="control-container" (click)="zoomRotation()">
                <span class="material-symbols-rounded">grid_view</span>
                Grid: {{ zoomLevel | zoomLevelLabel}}
            </div>
            <div i18n class="control-container" (click)="sortRotation()">
                <span class="material-symbols-rounded">sort</span>
                Sort by: {{ sortBy | sortByLabel }} (found: {{cards.length}})
            </div>
            <div i18n class="control-container" (click)="toggleTranslated()">
                <span class="material-symbols-rounded">language</span>
                <span>
                    @if (filters.translated === 'only') {
                        <span>Your</span>
                    } @else {
                        <span>All</span>
                    }
                    <span> languages</span>
                </span>
            </div>
            @if (firebase.$user() && firebase.$user()?.role === 'admin') {
                <div i18n class="control-container admin-control" (click)="showToApprove()">
                <span class="material-symbols-rounded">translate</span>
                Show to approve
            </div>
            }
        </div>
        <div class="cards-container" [class.small-size]="zoomLevel === 'small-size'"
            [class.medium-size]="zoomLevel === 'medium-size'" [class.large-size]="zoomLevel === 'large-size'"
            [class.standard-size]="zoomLevel === 'standard-size'">
            @for(card of cards; track card.code) {
                <app-card-component (click)="onCardClick(card)" [card]="card" [selectedCard]="selectedCard"
                    [selectedCardClass]="selectedCard && selectedCard.code === card.code"
                    [notSelectedCardClass]="selectedCard && selectedCard.code !== card.code"
                    [id]="card.code"></app-card-component>
            }
        </div>
        <app-card-detail [selectedCard]="selectedCard" [packs]="packs" (zoomCardEmit)="onCardZoomEmitted($event)"></app-card-detail>
    </div>
</div>

@if(selectedCard && cardZoomed) {
<div class="zoom-card-container">
    <div class="zoom-card-header">
        <p>Zoom</p>
        <span class="material-symbols-rounded" (click)="cardZoomed = false">close</span>
    </div>
    <div class="zoom-card-image">
        <img loading="lazy" [src]="'https://card-images.netrunnerdb.com/v2/large/' + selectedCard.code + '.jpg'" alt="">
    </div>
</div>
}